<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜è€ƒå¿—æ„¿æ¨èç³»ç»Ÿ</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #69cee0 0%, #a8e6cf 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #69cee0 0%, #5fb3c4 100%);
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(105, 206, 224, 0.3);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 300;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 300;
        }
        
        .content {
            padding: 30px;
        }
        
        .form-section {
            background: linear-gradient(135deg, #f0fdff 0%, #e8f8f5 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(105, 206, 224, 0.2);
            box-shadow: 0 2px 15px rgba(105, 206, 224, 0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid rgba(105, 206, 224, 0.3);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #69cee0;
            box-shadow: 0 0 0 3px rgba(105, 206, 224, 0.1);
            background: white;
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #69cee0 0%, #5fb3c4 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(105, 206, 224, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(105, 206, 224, 0.4);
        }

        .submit-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #69cee0;
            font-size: 18px;
            font-weight: 300;
        }
        
        .error {
            background: linear-gradient(135deg, #ffe6e6 0%, #ffcccc 100%);
            color: #c0392b;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #e74c3c;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.1);
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .user-info {
            background: linear-gradient(135deg, #69cee0 0%, #5fb3c4 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(105, 206, 224, 0.2);
        }



        .user-position-marker {
            position: absolute;
            background: #ff6b6b;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .school-tags {
            display: flex;
            gap: 5px;
            margin-left: 10px;
            flex-wrap: wrap;
        }

        .school-tag {
            background: linear-gradient(135deg, #69cee0, #5fb3c4);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            box-shadow: 0 2px 5px rgba(105, 206, 224, 0.2);
        }

        .school-tag.tag-985 {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
        }

        .school-tag.tag-211 {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .school-tag.tag-double-first-class {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
        }

        .school-name-container {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fdff 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(105, 206, 224, 0.1);
            border: 1px solid rgba(105, 206, 224, 0.1);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 300;
            color: #69cee0;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
            font-weight: 300;
        }
        
        .school-category {
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(105, 206, 224, 0.1);
            border: 1px solid rgba(105, 206, 224, 0.1);
        }

        .category-header {
            padding: 20px;
            color: white;
            font-size: 20px;
            font-weight: 300;
            text-align: center;
        }

        .rush .category-header {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
        }

        .stable .category-header {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .safe .category-header {
            background: linear-gradient(135deg, #69cee0, #a8e6cf);
        }
        
        .schools-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fdff 100%);
            padding: 20px;
            border-radius: 0 0 15px 15px;
        }

        .school-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdff 100%);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            border-left: 4px solid #69cee0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(105, 206, 224, 0.1);
        }

        .school-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(105, 206, 224, 0.2);
        }

        .rush .school-card {
            border-left-color: #ff7675;
        }

        .stable .school-card {
            border-left-color: #00b894;
        }

        .safe .school-card {
            border-left-color: #69cee0;
        }
        
        .school-name {
            font-size: 18px;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .school-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            border: 1px solid rgba(105, 206, 224, 0.1);
        }

        .info-label {
            font-weight: 500;
            color: #7f8c8d;
        }

        .probability {
            text-align: center;
            padding: 12px;
            border-radius: 10px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .prob-high {
            background: linear-gradient(135deg, #d1f2eb 0%, #a3e4d7 100%);
            color: #00695c;
        }

        .prob-medium {
            background: linear-gradient(135deg, #fef9e7 0%, #fcf3cf 100%);
            color: #b7950b;
        }

        .prob-low {
            background: linear-gradient(135deg, #fadbd8 0%, #f5b7b1 100%);
            color: #a93226;
        }
        
        .recommendation {
            background: linear-gradient(135deg, #e8f8f5 0%, #d5f4e6 100%);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #69cee0;
            font-style: italic;
            color: #2c3e50;
            font-weight: 300;
        }
        
        .hidden {
            display: none;
        }

        /* å±•å¼€/æ”¶èµ·åŠŸèƒ½æ ·å¼ */
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            user-select: none;
        }

        .category-header:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* ä¸åŒåˆ†ç±»çš„æ‚¬åœæ•ˆæœ - ä½¿ç”¨å¯¹åº”é¢œè‰²çš„æ·±è‰²ç‰ˆæœ¬ */
        .rush .category-header:hover {
            background: linear-gradient(135deg, #e84393, #fd79a8);
        }

        .stable .category-header:hover {
            background: linear-gradient(135deg, #00a085, #00b894);
        }

        .safe .category-header:hover {
            background: linear-gradient(135deg, #5fb3c4, #69cee0);
        }

        .category-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .toggle-button {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #69cee0;
            font-weight: 500;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .schools-container {
            transition: all 0.4s ease;
            overflow: hidden;
        }

        .schools-container.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: -15px;
        }

        .schools-container.expanded {
            max-height: none;
            opacity: 1;
        }

        /* é»˜è®¤æ˜¾ç¤ºå‰3æ‰€å­¦æ ¡ */
        .schools-container.preview {
            max-height: 400px;
            overflow: hidden;
            position: relative;
        }

        .schools-container.preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(transparent, rgba(255,255,255,0.9));
            pointer-events: none;
        }

        /* ç§‘ç›®é€‰æ‹©æ ·å¼ */
        .subject-selection-container {
            margin: 20px 0;
        }

        .subject-selection {
            background: linear-gradient(135deg, #f0fdff 0%, #e8f8f5 100%);
            border: 1px solid rgba(105, 206, 224, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.4s ease;
        }

        .subject-selection.changing {
            opacity: 0.7;
            transform: scale(0.98);
        }

        .subject-title {
            color: #2c3e50;
            font-weight: 500;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .subject-group {
            margin-bottom: 15px;
        }

        .subject-group-title {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 400;
        }

        .subject-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .subject-option {
            display: inline-block;
            padding: 8px 16px;
            border: 2px solid rgba(105, 206, 224, 0.3);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            user-select: none;
        }

        .subject-option:hover {
            border-color: #69cee0;
            background: rgba(105, 206, 224, 0.1);
            transform: translateY(-1px);
        }

        .subject-option.selected {
            background: linear-gradient(135deg, #69cee0, #5fb3c4);
            color: white;
            border-color: #69cee0;
            animation: selectPulse 0.3s ease;
        }

        .subject-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .validation-hint {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 10px;
            display: none;
        }

        .validation-hint.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes selectPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* å­¦æ ¡è¯¦æƒ…æ‚¬åœæç¤ºæ¡†æ ·å¼ */
        .school-detail-tooltip {
            position: fixed;
            z-index: 10000;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            border: 1px solid rgba(105, 206, 224, 0.2);
            width: 350px;
            max-height: 500px;
            overflow: hidden;
            opacity: 0;
            transform: translateY(10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            backdrop-filter: blur(10px);
        }

        .school-detail-tooltip.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .school-detail-header {
            background: linear-gradient(135deg, #69cee0, #5fb3c4);
            color: white;
            padding: 16px 20px;
            border-radius: 12px 12px 0 0;
        }

        .school-detail-title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .school-detail-title {
            font-size: 16px;
            font-weight: 600;
            line-height: 1.3;
            flex: 1;
        }

        .school-detail-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            margin-left: 10px;
        }

        .school-detail-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .school-detail-btn:active {
            transform: translateY(0);
        }

        .school-detail-subtitle {
            font-size: 13px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .school-detail-content {
            max-height: 420px;
            overflow-y: auto;
            padding: 0;
        }

        .school-detail-content::-webkit-scrollbar {
            width: 6px;
        }

        .school-detail-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .school-detail-content::-webkit-scrollbar-thumb {
            background: #69cee0;
            border-radius: 3px;
        }

        .school-detail-content::-webkit-scrollbar-thumb:hover {
            background: #5fb3c4;
        }

        .detail-section {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 8px 12px;
            background: rgba(105, 206, 224, 0.05);
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.4;
            border-left: 3px solid rgba(105, 206, 224, 0.3);
        }

        .detail-label {
            color: #555;
            font-weight: 600;
            min-width: 70px;
            margin-right: 12px;
        }

        .detail-value {
            color: #333;
            flex: 1;
            text-align: right;
            word-break: break-word;
            font-weight: 500;
        }

        .detail-value.empty {
            color: #999;
            font-style: italic;
            font-weight: normal;
        }

        .detail-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .detail-tag {
            background: linear-gradient(135deg, #69cee0, #5fb3c4);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .detail-tag.tag-985 {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
        }

        .detail-tag.tag-211 {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .detail-tag.tag-double-first-class {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
        }

        .detail-text-item {
            margin-bottom: 16px;
        }

        .detail-text-item:last-child {
            margin-bottom: 0;
        }

        .detail-text-label {
            color: #555;
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .detail-description {
            color: #666;
            line-height: 1.6;
            font-size: 13px;
            text-align: justify;
            background: rgba(105, 206, 224, 0.03);
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid rgba(105, 206, 224, 0.2);
        }

        .detail-empty {
            color: #999;
            font-style: italic;
            font-size: 12px;
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.02);
            border-radius: 6px;
        }

        /* å­¦æ ¡å¡ç‰‡æ‚¬åœçŠ¶æ€ */
        .school-card {
            position: relative;
        }

        .school-card.tooltip-active {
            z-index: 1;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .subject-options {
                gap: 6px;
            }

            .subject-option {
                padding: 6px 12px;
                font-size: 13px;
            }

            .school-detail-tooltip {
                width: 300px;
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ é«˜è€ƒå¿—æ„¿æ¨èç³»ç»Ÿ</h1>
            <p>åŸºäºå†å¹´å½•å–æ•°æ®ï¼Œä¸ºæ‚¨æ¨èæœ€é€‚åˆçš„å¤§å­¦</p>
        </div>
        
        <div class="content">
            <div class="form-section">
                <h2 style="margin-bottom: 20px; color: #2c3e50; font-weight: 300;">ğŸ“ è¯·è¾“å…¥æ‚¨çš„ä¿¡æ¯</h2>
                <form id="recommendationForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="userScore">é«˜è€ƒåˆ†æ•°</label>
                            <input type="number" id="userScore" placeholder="è¯·è¾“å…¥æ‚¨çš„é«˜è€ƒåˆ†æ•°" min="0" max="750" required>
                        </div>
                        <div class="form-group">
                            <label for="provinceId">çœä»½</label>
                            <select id="provinceId" required onchange="onProvinceChange()">
                                <option value="">è¯·é€‰æ‹©çœä»½</option>
                                <option value="22">å®‰å¾½</option>
                                <option value="15">ç¦å»º</option>
                                <option value="24">ç”˜è‚ƒ</option>
                                <option value="19">å¹¿ä¸œ</option>
                                <option value="23">å¹¿è¥¿</option>
                                <option value="1">æ²³å—</option>
                                <option value="9">é»‘é¾™æ±Ÿ</option>
                                <option value="16">æ¹–åŒ—</option>
                                <option value="17">æ¹–å—</option>
                                <option value="8">æ±Ÿè¥¿</option>
                                <option value="25">å®å¤</option>
                                <option value="7">å±±è¥¿</option>
                                <option value="5">é™•è¥¿</option>
                                <option value="27">å››å·</option>
                                <option value="29">æ–°ç–†</option>
                                <option value="26">äº‘å—</option>
                                <option value="10">æµ™æ±Ÿ</option>
                            </select>
                        </div>
                    </div>

                    <!-- åŠ¨æ€ç§‘ç›®é€‰æ‹©åŒºåŸŸ -->
                    <div id="subjectSelectionContainer" class="subject-selection-container hidden">
                        <div class="subject-selection">
                            <div class="subject-title">ğŸ“š ç§‘ç›®é€‰æ‹©</div>
                            <div id="subjectContent">
                                <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                            </div>
                            <div id="validationHint" class="validation-hint"></div>
                        </div>
                    </div>

                    <div class="form-grid">

                        <div class="form-group">
                            <label for="schoolType">å­¦æ ¡ç±»å‹ï¼ˆå¯é€‰ï¼‰</label>
                            <select id="schoolType">
                                <option value="">ä¸é™åˆ¶</option>
                                <option value="ç»¼åˆ">ç»¼åˆç±»</option>
                                <option value="ç†å·¥">ç†å·¥ç±»</option>
                                <option value="å¸ˆèŒƒ">å¸ˆèŒƒç±»</option>
                                <option value="åŒ»è¯">åŒ»è¯ç±»</option>
                                <option value="è´¢ç»">è´¢ç»ç±»</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn" id="submitBtn">
                        ğŸ” è·å–æ¨è
                    </button>
                </form>
            </div>
            
            <div id="loadingDiv" class="loading hidden">
                <div>ğŸ”„ æ­£åœ¨åˆ†ææ‚¨çš„åˆ†æ•°ï¼Œæ¨èåˆé€‚çš„å­¦æ ¡...</div>
            </div>
            
            <div id="errorDiv" class="error hidden"></div>
            
            <div id="resultDiv" class="result-section hidden">
                <div id="userInfo" class="user-info"></div>
                <div id="statsDiv" class="stats-grid"></div>
                <div id="rushSchools" class="school-category rush"></div>
                <div id="stableSchools" class="school-category stable"></div>
                <div id="safeSchools" class="school-category safe"></div>
            </div>
        </div>
    </div>
    <script>
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            document.getElementById('loadingDiv').classList.remove('hidden');
            document.getElementById('errorDiv').classList.add('hidden');
            document.getElementById('resultDiv').classList.add('hidden');
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').textContent = 'ğŸ”„ æ¨èä¸­...';
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.getElementById('loadingDiv').classList.add('hidden');
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').textContent = 'ğŸ” è·å–æ¨è';
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            hideLoading();
            document.getElementById('errorDiv').classList.remove('hidden');
            document.getElementById('errorDiv').textContent = 'âŒ ' + message;
            document.getElementById('resultDiv').classList.add('hidden');
        }

        // æ˜¾ç¤ºæˆåŠŸç»“æœ
        function showResult(data) {
            hideLoading();
            document.getElementById('errorDiv').classList.add('hidden');
            document.getElementById('resultDiv').classList.remove('hidden');

            // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
            const userInfo = data.userInfo || {};
            document.getElementById('userInfo').innerHTML = `
                <h3>ğŸ“Š æ‚¨çš„åŸºæœ¬ä¿¡æ¯</h3>
                <p><strong>åˆ†æ•°ï¼š</strong>${userInfo.userScore || 'æœªçŸ¥'}åˆ† |
                   <strong>çœä»½ï¼š</strong>${userInfo.provinceName || 'æœªçŸ¥'} |
                   <strong>ç§‘ç±»ï¼š</strong>${userInfo.subjectCategoryName || 'æœªçŸ¥'}</p>
                <p><strong>é¢„ä¼°ä½æ¬¡ï¼š</strong>${userInfo.estimatedRank || 'æœªçŸ¥'}</p>

            `;



            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const stats = data.statistics || {};
            document.getElementById('statsDiv').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.rushCount || 0}</div>
                    <div class="stat-label">å†²åˆºå­¦æ ¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.stableCount || 0}</div>
                    <div class="stat-label">ç¨³å¦¥å­¦æ ¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.safeCount || 0}</div>
                    <div class="stat-label">ä¿åº•å­¦æ ¡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalCount || 0}</div>
                    <div class="stat-label">æ€»æ¨èæ•°</div>
                </div>
            `;

            // æ˜¾ç¤ºå„ç±»å­¦æ ¡
            displaySchools('rushSchools', 'ğŸš€ å†²åˆºå­¦æ ¡', data.rushSchools || []);
            displaySchools('stableSchools', 'âœ… ç¨³å¦¥å­¦æ ¡', data.stableSchools || []);
            displaySchools('safeSchools', 'ğŸ›¡ï¸ ä¿åº•å­¦æ ¡', data.safeSchools || []);
        }

        // æ˜¾ç¤ºå­¦æ ¡åˆ—è¡¨
        function displaySchools(containerId, title, schools) {
            const container = document.getElementById(containerId);

            if (!schools || schools.length === 0) {
                container.innerHTML = `
                    <div class="category-header" onclick="toggleCategory('${containerId}')">
                        <div class="category-title">${title} (0æ‰€)</div>
                        <div class="toggle-button">
                            <span>å±•å¼€</span>
                            <span class="toggle-icon">â–¼</span>
                        </div>
                    </div>
                    <div class="schools-container collapsed" id="${containerId}-container">
                        <div style="text-align: center; color: #666; padding: 20px;">æš‚æ— æ¨èå­¦æ ¡</div>
                    </div>
                `;
                return;
            }

            let schoolsHtml = schools.map(school => `
                <div class="school-card">
                    <div class="school-name-container">
                        <div class="school-name">${school.schoolName || 'æœªçŸ¥å­¦æ ¡'}</div>
                        <div class="school-tags">${generateSchoolTags(school.tags)}</div>
                    </div>
                    <div class="school-info">
                        <div class="info-item">
                            <span class="info-label">ç±»å‹ï¼š</span>
                            ${school.schoolType || 'æœªçŸ¥'}
                        </div>
                        <div class="info-item">
                            <span class="info-label">çœä»½ï¼š</span>
                            ${school.schoolProvince || 'æœªçŸ¥'}
                        </div>
                        <div class="info-item">
                            <span class="info-label">å†å¹´æœ€ä½åˆ†ï¼š</span>
                            ${school.historicalMinScore || 'æœªçŸ¥'}
                        </div>
                        <div class="info-item">
                            <span class="info-label">æœ€ä½ä½æ¬¡ï¼š</span>
                            ${school.historicalMinRank || 'æœªçŸ¥'}
                        </div>
                    </div>
                    <div class="probability ${getProbabilityClass(school.admissionProbability)}">
                        å½•å–æ¦‚ç‡ï¼š${school.admissionProbability ? school.admissionProbability.toFixed(1) : 'æœªçŸ¥'}%
                    </div>
                    <div class="recommendation">
                        ${school.recommendationReason || 'æš‚æ— æ¨èç†ç”±'}
                    </div>
                </div>
            `).join('');

            // åˆ¤æ–­æ˜¯å¦éœ€è¦å±•å¼€/æ”¶èµ·åŠŸèƒ½ï¼ˆè¶…è¿‡5æ‰€å­¦æ ¡æ—¶å¯ç”¨ï¼‰
            const needToggle = schools.length > 5;
            const initialState = needToggle ? 'collapsed' : 'expanded';
            const toggleText = needToggle ? 'å±•å¼€' : '';
            const toggleIcon = needToggle ? 'â–¼' : '';

            container.innerHTML = `
                <div class="category-header" onclick="toggleCategory('${containerId}')">
                    <div class="category-title">${title} (${schools.length}æ‰€)</div>
                    ${needToggle ? `
                        <div class="toggle-button">
                            <span class="toggle-text">å±•å¼€</span>
                            <span class="toggle-icon">â–¼</span>
                        </div>
                    ` : ''}
                </div>
                <div class="schools-container ${initialState}" id="${containerId}-container">
                    ${schoolsHtml}
                </div>
            `;

            // ä¸ºæ¯ä¸ªå­¦æ ¡å¡ç‰‡æ·»åŠ æ‚¬åœäº‹ä»¶
            setTimeout(() => {
                const schoolCards = container.querySelectorAll('.school-card');
                schoolCards.forEach((card, index) => {
                    if (schools[index]) {
                        addSchoolTooltipEvents(card, schools[index]);
                    }
                });

                // åˆå§‹åŒ–æç¤ºæ¡†äº‹ä»¶
                if (schoolTooltip) {
                    initTooltipEvents();
                }
            }, 100);
        }

        // è·å–æ¦‚ç‡æ ·å¼ç±»
        function getProbabilityClass(probability) {
            if (!probability) return 'prob-low';
            if (probability >= 80) return 'prob-high';
            if (probability >= 50) return 'prob-medium';
            return 'prob-low';
        }

        // åˆ‡æ¢åˆ†ç±»å±•å¼€/æ”¶èµ·çŠ¶æ€
        function toggleCategory(containerId) {
            const container = document.getElementById(containerId + '-container');
            const header = document.querySelector(`#${containerId} .category-header`);
            const toggleButton = header.querySelector('.toggle-button');

            if (!toggleButton) return; // å¦‚æœæ²¡æœ‰åˆ‡æ¢æŒ‰é’®ï¼Œç›´æ¥è¿”å›

            const toggleText = toggleButton.querySelector('.toggle-text');
            const toggleIcon = toggleButton.querySelector('.toggle-icon');

            if (container.classList.contains('collapsed')) {
                // å±•å¼€
                container.classList.remove('collapsed');
                container.classList.add('expanded');
                toggleText.textContent = 'æ”¶èµ·';
                toggleIcon.classList.add('expanded');
            } else {
                // æ”¶èµ·
                container.classList.remove('expanded');
                container.classList.add('collapsed');
                toggleText.textContent = 'å±•å¼€';
                toggleIcon.classList.remove('expanded');
            }
        }

        // å­¦æ ¡è¯¦æƒ…æç¤ºæ¡†ç›¸å…³å˜é‡
        let schoolTooltip = null;
        let tooltipTimeout = null;
        let hideTimeout = null;

        // åˆ›å»ºå­¦æ ¡è¯¦æƒ…æç¤ºæ¡†
        function createSchoolTooltip() {
            if (schoolTooltip) return schoolTooltip;

            schoolTooltip = document.createElement('div');
            schoolTooltip.className = 'school-detail-tooltip';
            document.body.appendChild(schoolTooltip);

            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            addTooltipEvents();
            schoolTooltip.hasEventListeners = true;

            return schoolTooltip;
        }

        // æ˜¾ç¤ºå­¦æ ¡è¯¦æƒ…æç¤ºæ¡†
        function showSchoolTooltip(schoolData, event) {
            // æ¸…é™¤éšè—å®šæ—¶å™¨
            if (hideTimeout) {
                clearTimeout(hideTimeout);
                hideTimeout = null;
            }

            const tooltip = createSchoolTooltip();

            // ç”Ÿæˆè¯¦æƒ…å†…å®¹
            const content = generateSchoolDetailContent(schoolData);
            tooltip.innerHTML = content;

            // è®¡ç®—ä½ç½® - åŸºäºå­¦æ ¡åç§°ä½ç½®
            const schoolCard = event.target.closest('.school-card');
            const schoolNameElement = schoolCard.querySelector('.school-name');
            const rect = schoolNameElement ? schoolNameElement.getBoundingClientRect() : schoolCard.getBoundingClientRect();

            const tooltipWidth = 350;
            const tooltipHeight = Math.min(500, window.innerHeight - 40);

            // é»˜è®¤æ˜¾ç¤ºåœ¨å­¦æ ¡åç§°å³ä¾§
            let left = rect.right + 15;
            let top = rect.top - 10; // ç¨å¾®å‘ä¸Šåç§»ï¼Œä¸åç§°å¯¹é½

            // æ£€æŸ¥å³ä¾§ç©ºé—´ï¼Œä¸è¶³æ—¶æ˜¾ç¤ºåœ¨å·¦ä¾§
            if (left + tooltipWidth > window.innerWidth - 20) {
                left = rect.left - tooltipWidth - 15;
            }

            // æ£€æŸ¥é¡¶éƒ¨ç©ºé—´
            if (top + tooltipHeight > window.innerHeight - 20) {
                top = window.innerHeight - tooltipHeight - 20;
            }

            // ç¡®ä¿ä¸è¶…å‡ºå±å¹•é¡¶éƒ¨
            if (top < 20) {
                top = 20;
            }

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';

            // æ˜¾ç¤ºæç¤ºæ¡†
            setTimeout(() => {
                tooltip.classList.add('show');
            }, 10);
        }

        // éšè—å­¦æ ¡è¯¦æƒ…æç¤ºæ¡†
        function hideSchoolTooltip() {
            if (hideTimeout) {
                clearTimeout(hideTimeout);
            }

            hideTimeout = setTimeout(() => {
                if (schoolTooltip) {
                    schoolTooltip.classList.remove('show');
                }
            }, 200);
        }

        // çœä»½IDåˆ°åç§°çš„æ˜ å°„
        const provinceMap = {
            1: 'å®‰å¾½çœ', 2: 'ç¦å»ºçœ', 3: 'ç”˜è‚ƒçœ', 4: 'å¹¿ä¸œçœ', 5: 'å¹¿è¥¿å£®æ—è‡ªæ²»åŒº',
            6: 'ä¸Šæµ·å¸‚', 7: 'è´µå·çœ', 8: 'æµ·å—çœ', 9: 'æ²³åŒ—çœ', 10: 'æµ™æ±Ÿçœ',
            11: 'æ²³å—çœ', 12: 'é»‘é¾™æ±Ÿçœ', 13: 'æ¹–åŒ—çœ', 14: 'æ¹–å—çœ', 15: 'å‰æ—çœ',
            16: 'æ±Ÿè‹çœ', 17: 'æ±Ÿè¥¿çœ', 18: 'è¾½å®çœ', 19: 'å†…è’™å¤è‡ªæ²»åŒº', 20: 'åŒ—äº¬å¸‚',
            21: 'å®å¤å›æ—è‡ªæ²»åŒº', 22: 'é’æµ·çœ', 23: 'å±±ä¸œçœ', 24: 'å±±è¥¿çœ', 25: 'é™•è¥¿çœ',
            26: 'å››å·çœ', 27: 'å¤©æ´¥å¸‚', 28: 'è¥¿è—è‡ªæ²»åŒº', 29: 'æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº', 30: 'äº‘å—çœ',
            31: 'é‡åº†å¸‚'
        };

        // ç”Ÿæˆå­¦æ ¡è¯¦æƒ…å†…å®¹
        function generateSchoolDetailContent(school) {
            const tags = school.tags ? school.tags.split(',').filter(tag => tag.trim()) : [];
            const provinceName = provinceMap[school.provinceId] || 'æœªçŸ¥çœä»½';
            const schoolName = school.schoolName || school.name || 'æœªçŸ¥å­¦æ ¡';

            return `
                <div class="school-detail-header">
                    <div class="school-detail-title-row">
                        <div class="school-detail-title">${schoolName}</div>
                        <button class="school-detail-btn" onclick="searchSchoolWebsite('${schoolName}')" title="æœç´¢å­¦æ ¡å®˜ç½‘">
                            è¯¦ç»†
                        </button>
                    </div>
                    <div class="school-detail-subtitle">
                        <span>ğŸ“ ${provinceName}</span>
                        <span>ğŸ“ ${school.schoolType || 'æœªçŸ¥ç±»å‹'}</span>
                    </div>
                </div>
                <div class="school-detail-content">
                    ${generateBasicInfoSection(school, provinceName)}
                    ${generateAdmissionInfoSection(school)}
                    ${generateTagsSection(tags)}
                    ${generateProfessionsSection(school)}
                    ${generateIntroductionSection(school)}
                </div>
            `;
        }

        // ç”ŸæˆåŸºæœ¬ä¿¡æ¯éƒ¨åˆ†
        function generateBasicInfoSection(school, provinceName) {
            // å¤„ç†å„ç§å¯èƒ½çš„å­—æ®µåç§°ï¼Œä½¿ç”¨æ¨èAPIè¿”å›çš„å­—æ®µå
            const schoolName = school.schoolName || school.name || 'æœªçŸ¥';
            const schoolLevel = school.schoolLevel || 'æœªçŸ¥';
            const ownershipType = school.ownershipType || 'æœªçŸ¥';
            const schoolType = school.schoolType || 'æœªçŸ¥';
            const schoolAffiliation = school.schoolAffiliation || 'æœªçŸ¥';

            return `
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ« åŸºæœ¬ä¿¡æ¯</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">å­¦æ ¡åç§°</span>
                            <span class="detail-value">${schoolName}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">åŠå­¦å±‚æ¬¡</span>
                            <span class="detail-value">${schoolLevel}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">åŠå­¦æ€§è´¨</span>
                            <span class="detail-value">${ownershipType}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">é™¢æ ¡ç±»å‹</span>
                            <span class="detail-value">${schoolType}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">éš¶å±å•ä½</span>
                            <span class="detail-value">${schoolAffiliation}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æ‰€åœ¨çœä»½</span>
                            <span class="detail-value">${provinceName}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆå½•å–ä¿¡æ¯éƒ¨åˆ†
        function generateAdmissionInfoSection(school) {
            const minScore = school.historicalMinScore || 'æš‚æ— æ•°æ®';
            const minRank = school.historicalMinRank || 'æš‚æ— æ•°æ®';
            const probability = school.admissionProbability ? school.admissionProbability.toFixed(1) + '%' : 'æš‚æ— æ•°æ®';

            return `
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ“Š å½•å–ä¿¡æ¯</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">å†å¹´æœ€ä½åˆ†</span>
                            <span class="detail-value ${minScore === 'æš‚æ— æ•°æ®' ? 'empty' : ''}">${minScore}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">æœ€ä½ä½æ¬¡</span>
                            <span class="detail-value ${minRank === 'æš‚æ— æ•°æ®' ? 'empty' : ''}">${minRank}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">å½•å–æ¦‚ç‡</span>
                            <span class="detail-value ${probability === 'æš‚æ— æ•°æ®' ? 'empty' : ''}">${probability}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆæ ‡ç­¾éƒ¨åˆ†
        function generateTagsSection(tags) {
            if (!tags || tags.length === 0) {
                return `
                    <div class="detail-section">
                        <div class="detail-section-title">ğŸ† é™¢æ ¡æ ‡ç­¾</div>
                        <div class="detail-empty">æš‚æ— ç‰¹æ®Šæ ‡ç­¾</div>
                    </div>
                `;
            }

            const tagElements = tags.map(tag => {
                const trimmedTag = tag.trim();
                let tagClass = 'detail-tag';

                if (trimmedTag === '985') tagClass += ' tag-985';
                else if (trimmedTag === '211') tagClass += ' tag-211';
                else if (trimmedTag === 'åŒä¸€æµ') tagClass += ' tag-double-first-class';

                return `<span class="${tagClass}">${trimmedTag}</span>`;
            }).join('');

            return `
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ† é™¢æ ¡æ ‡ç­¾</div>
                    <div class="detail-tags">${tagElements}</div>
                </div>
            `;
        }

        // ç”Ÿæˆç‰¹è‰²ä¸“ä¸šéƒ¨åˆ†
        function generateProfessionsSection(school) {
            const hasProfessions = school.schoolNationalProfessions && school.schoolNationalProfessions.trim();

            if (!hasProfessions) {
                return `
                    <div class="detail-section">
                        <div class="detail-section-title">ğŸ“ ç‰¹è‰²ä¸“ä¸š</div>
                        <div class="detail-empty">æš‚æ— ç‰¹è‰²ä¸“ä¸šä¿¡æ¯</div>
                    </div>
                `;
            }

            // å¤„ç†ç‰¹è‰²ä¸“ä¸šï¼Œå°†åˆ†å·åˆ†éš”çš„ä¸“ä¸šè½¬æ¢ä¸ºæ›´å¥½çš„æ˜¾ç¤ºæ ¼å¼
            const professions = school.schoolNationalProfessions
                .split(';')
                .filter(p => p.trim())
                .map(p => p.trim())
                .join('ã€');

            return `
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ“ ç‰¹è‰²ä¸“ä¸š</div>
                    <div class="detail-grid">
                        <div class="detail-text-item">
                            <div class="detail-description">${professions}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç”Ÿæˆå­¦æ ¡ä»‹ç»éƒ¨åˆ†
        function generateIntroductionSection(school) {
            const hasIntroduction = school.schoolIntroduction && school.schoolIntroduction.trim();

            if (!hasIntroduction) {
                return `
                    <div class="detail-section">
                        <div class="detail-section-title">ğŸ“ å­¦æ ¡ç®€ä»‹</div>
                        <div class="detail-empty">æš‚æ— å­¦æ ¡ç®€ä»‹ä¿¡æ¯</div>
                    </div>
                `;
            }

            // æˆªå–ç®€ä»‹çš„å‰500ä¸ªå­—ç¬¦ï¼Œé¿å…è¿‡é•¿
            const introduction = school.schoolIntroduction.length > 500
                ? school.schoolIntroduction.substring(0, 500) + '...'
                : school.schoolIntroduction;

            return `
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ“ å­¦æ ¡ç®€ä»‹</div>
                    <div class="detail-grid">
                        <div class="detail-text-item">
                            <div class="detail-description">${introduction}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ä¸ºå­¦æ ¡å¡ç‰‡æ·»åŠ æ‚¬åœäº‹ä»¶
        function addSchoolTooltipEvents(schoolCard, schoolData) {
            let isHovering = false;

            // é¼ æ ‡è¿›å…¥å­¦æ ¡å¡ç‰‡
            schoolCard.addEventListener('mouseenter', function(e) {
                isHovering = true;

                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                if (tooltipTimeout) {
                    clearTimeout(tooltipTimeout);
                }

                // 0.8ç§’åæ˜¾ç¤ºæç¤ºæ¡†
                tooltipTimeout = setTimeout(() => {
                    if (isHovering) {
                        showSchoolTooltip(schoolData, e);
                        schoolCard.classList.add('tooltip-active');
                    }
                }, 800);
            });

            // é¼ æ ‡ç¦»å¼€å­¦æ ¡å¡ç‰‡
            schoolCard.addEventListener('mouseleave', function() {
                isHovering = false;

                // æ¸…é™¤æ˜¾ç¤ºå®šæ—¶å™¨
                if (tooltipTimeout) {
                    clearTimeout(tooltipTimeout);
                    tooltipTimeout = null;
                }

                schoolCard.classList.remove('tooltip-active');

                // å»¶è¿Ÿéšè—æç¤ºæ¡†
                hideSchoolTooltip();
            });
        }

        // ä¸ºæç¤ºæ¡†æ·»åŠ é¼ æ ‡äº‹ä»¶
        function addTooltipEvents() {
            if (!schoolTooltip) return;

            // é¼ æ ‡è¿›å…¥æç¤ºæ¡†
            schoolTooltip.addEventListener('mouseenter', function() {
                // æ¸…é™¤éšè—å®šæ—¶å™¨
                if (hideTimeout) {
                    clearTimeout(hideTimeout);
                    hideTimeout = null;
                }
            });

            // é¼ æ ‡ç¦»å¼€æç¤ºæ¡†
            schoolTooltip.addEventListener('mouseleave', function() {
                hideSchoolTooltip();
            });
        }

        // åˆå§‹åŒ–æç¤ºæ¡†äº‹ä»¶ï¼ˆåœ¨åˆ›å»ºæç¤ºæ¡†åè°ƒç”¨ï¼‰
        function initTooltipEvents() {
            if (schoolTooltip && !schoolTooltip.hasEventListeners) {
                addTooltipEvents();
                schoolTooltip.hasEventListeners = true;
            }
        }

        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('recommendationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // éªŒè¯ç§‘ç›®é€‰æ‹©
            if (!validateSubjectSelection()) {
                return;
            }

            showLoading();

            try {
                // è·å–è¡¨å•æ•°æ®
                const userScore = document.getElementById('userScore').value;
                const provinceId = document.getElementById('provinceId').value;
                const subjectCategoryId = getSubjectCategoryId(); // ä½¿ç”¨åŠ¨æ€è®¡ç®—çš„ç§‘ç±»ID
                const schoolType = document.getElementById('schoolType').value;

                // æ„å»ºè¯·æ±‚URLï¼Œé»˜è®¤ä½¿ç”¨2024å¹´æ•°æ®ï¼Œä¸é™åˆ¶æ¨èæ•°é‡
                let url = `/api/recommendations/basic?userScore=${userScore}&provinceId=${provinceId}&subjectCategoryId=${subjectCategoryId}&year=2024`;
                if (schoolType) url += `&schoolType=${schoolType}`;

                console.log('è¯·æ±‚URL:', url);

                // å‘é€è¯·æ±‚
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('å“åº”ç»“æœ:', result);

                if (result.code === 200) {
                    showResult(result.data);
                } else {
                    showError(`è¯·æ±‚å¤±è´¥ï¼š${result.message || 'æœªçŸ¥é”™è¯¯'}`);
                }

            } catch (error) {
                console.error('è¯·æ±‚é”™è¯¯:', error);
                showError(`ç½‘ç»œé”™è¯¯ï¼š${error.message}`);
            }
        });

        // ç”Ÿæˆå­¦æ ¡æ ‡ç­¾HTML
        function generateSchoolTags(tags) {
            if (!tags) return '';

            const tagList = tags.split(',').map(tag => tag.trim()).filter(tag => tag);
            return tagList.map(tag => {
                let tagClass = 'school-tag';
                let tagText = tag;

                if (tag === '985') {
                    tagClass += ' tag-985';
                    tagText = '985';
                } else if (tag === '211') {
                    tagClass += ' tag-211';
                    tagText = '211';
                } else if (tag === 'åŒä¸€æµ' || tag === 'åŒä¸€æµå¤§å­¦') {
                    tagClass += ' tag-double-first-class';
                    tagText = 'åŒä¸€æµ';
                }

                return `<span class="${tagClass}">${tagText}</span>`;
            }).join('');
        }





        // çœä»½è€ƒè¯•ç±»å‹ç¼“å­˜ï¼ˆä»APIåŠ¨æ€è·å–ï¼‰
        const provinceExamTypes = {};

        // å½“å‰é€‰æ‹©çš„ç§‘ç›®
        let selectedSubjects = [];
        let currentExamType = null;

        // çœä»½æ”¹å˜æ—¶çš„å¤„ç†å‡½æ•°
        async function onProvinceChange() {
            const provinceId = document.getElementById('provinceId').value;
            const container = document.getElementById('subjectSelectionContainer');

            if (!provinceId) {
                container.classList.add('hidden');
                return;
            }

            try {
                // ä»ç¼“å­˜è·å–æˆ–ä»APIè·å–çœä»½è€ƒè¯•ç±»å‹
                let examType = provinceExamTypes[provinceId];
                if (examType === undefined) {
                    examType = await getProvinceExamType(provinceId);
                    provinceExamTypes[provinceId] = examType; // ç¼“å­˜ç»“æœ
                }

                currentExamType = examType;
                selectedSubjects = [];

                // æ˜¾ç¤ºç§‘ç›®é€‰æ‹©åŒºåŸŸ
                container.classList.remove('hidden');

                // æ ¹æ®è€ƒè¯•ç±»å‹ç”Ÿæˆä¸åŒçš„é€‰æ‹©ç•Œé¢
                generateSubjectSelection(examType);

            } catch (error) {
                console.error('è·å–çœä»½è€ƒè¯•ç±»å‹å¤±è´¥:', error);
                showValidationHint('è·å–çœä»½ä¿¡æ¯å¤±è´¥ï¼Œè¯·é‡è¯•');
                container.classList.add('hidden');
            }
        }

        // ä»APIè·å–çœä»½è€ƒè¯•ç±»å‹
        async function getProvinceExamType(provinceId) {
            try {
                const response = await fetch(`/api/test/provinces`);
                if (!response.ok) {
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                }

                const result = await response.json();
                if (result.code !== 200 || !result.data) {
                    throw new Error('APIè¿”å›é”™è¯¯');
                }

                // æŸ¥æ‰¾å¯¹åº”çœä»½çš„è€ƒè¯•ç±»å‹
                const province = result.data.find(p => p.id == provinceId);
                if (!province) {
                    throw new Error('çœä»½ä¸å­˜åœ¨');
                }

                // æ ¹æ®æ•°æ®åº“ä¸­çš„provinceExamTypeæ˜ å°„åˆ°å‰ç«¯çš„è€ƒè¯•æ¨¡å¼
                // 0: æ–°é«˜è€ƒ3+3æ¨¡å¼ â†’ 0 (æµ™æ±Ÿã€ä¸Šæµ·ã€åŒ—äº¬ã€å¤©æ´¥ã€æµ·å—ã€å±±ä¸œ)
                // 1: æ–°é«˜è€ƒ3+1+2æ¨¡å¼ â†’ 1 (å¤§éƒ¨åˆ†çœä»½)
                // 2: ä¼ ç»Ÿæ–‡ç†åˆ†ç§‘ â†’ 2 (æ–°ç–†ã€è¥¿è—ç­‰å°‘æ•°çœä»½)

                if (province.provinceExamType === 0) {
                    return 0; // 3+3æ¨¡å¼ï¼šæµ™æ±Ÿã€ä¸Šæµ·ã€åŒ—äº¬ã€å¤©æ´¥ã€æµ·å—ã€å±±ä¸œ
                } else if (province.provinceExamType === 1) {
                    return 1; // 3+1+2æ¨¡å¼ï¼šæ¹–åŒ—ã€æ¹–å—ã€å¹¿ä¸œã€ç¦å»ºã€æ±Ÿè‹ã€æ²³åŒ—ã€è¾½å®ã€é‡åº†ã€æ²³å—ã€å±±è¥¿ã€é™•è¥¿ã€å®‰å¾½ã€æ±Ÿè¥¿ã€é»‘é¾™æ±Ÿã€å‰æ—ã€å¹¿è¥¿ã€å››å·ã€è´µå·ã€äº‘å—ã€ç”˜è‚ƒã€å®å¤ã€é’æµ·ç­‰
                } else {
                    return 2; // ä¼ ç»Ÿæ–‡ç†åˆ†ç§‘ï¼šæ–°ç–†ã€è¥¿è—ç­‰
                }

            } catch (error) {
                console.error('è·å–çœä»½è€ƒè¯•ç±»å‹å¤±è´¥:', error);
                // é»˜è®¤è¿”å›æ–‡ç†åˆ†ç§‘æ¨¡å¼
                return 2;
            }
        }

        // ç”Ÿæˆç§‘ç›®é€‰æ‹©ç•Œé¢
        function generateSubjectSelection(examType) {
            const content = document.getElementById('subjectContent');
            const selection = document.querySelector('.subject-selection');

            // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
            selection.classList.add('changing');

            setTimeout(() => {
                let html = '';

                if (examType === 1) {
                    // 3+1+2æ¨¡å¼
                    html = `
                        <div class="subject-group">
                            <div class="subject-group-title">é¦–é€‰ç§‘ç›® (å¿…é€‰ä¸€é—¨)</div>
                            <div class="subject-options">
                                <div class="subject-option" data-subject="physics" data-type="primary" onclick="selectSubject(this)">ç‰©ç†</div>
                                <div class="subject-option" data-subject="history" data-type="primary" onclick="selectSubject(this)">å†å²</div>
                            </div>
                        </div>
                        <div class="subject-group">
                            <div class="subject-group-title">å†é€‰ç§‘ç›® (ä»»é€‰ä¸¤é—¨)</div>
                            <div class="subject-options">
                                <div class="subject-option" data-subject="chemistry" data-type="secondary" onclick="selectSubject(this)">åŒ–å­¦</div>
                                <div class="subject-option" data-subject="biology" data-type="secondary" onclick="selectSubject(this)">ç”Ÿç‰©</div>
                                <div class="subject-option" data-subject="geography" data-type="secondary" onclick="selectSubject(this)">åœ°ç†</div>
                                <div class="subject-option" data-subject="politics" data-type="secondary" onclick="selectSubject(this)">æ€æƒ³æ”¿æ²»</div>
                            </div>
                        </div>
                    `;
                } else if (examType === 0) {
                    // 3+3æ¨¡å¼
                    html = `
                        <div class="subject-group">
                            <div class="subject-group-title">é€‰è€ƒç§‘ç›® (ä»»é€‰ä¸‰é—¨)</div>
                            <div class="subject-options">
                                <div class="subject-option" data-subject="physics" data-type="elective" onclick="selectSubject(this)">ç‰©ç†</div>
                                <div class="subject-option" data-subject="chemistry" data-type="elective" onclick="selectSubject(this)">åŒ–å­¦</div>
                                <div class="subject-option" data-subject="biology" data-type="elective" onclick="selectSubject(this)">ç”Ÿç‰©</div>
                                <div class="subject-option" data-subject="history" data-type="elective" onclick="selectSubject(this)">å†å²</div>
                                <div class="subject-option" data-subject="geography" data-type="elective" onclick="selectSubject(this)">åœ°ç†</div>
                                <div class="subject-option" data-subject="politics" data-type="elective" onclick="selectSubject(this)">æ€æƒ³æ”¿æ²»</div>
                            </div>
                        </div>
                    `;
                } else if (examType === 2) {
                    // æ–‡ç†åˆ†ç§‘æ¨¡å¼
                    html = `
                        <div class="subject-group">
                            <div class="subject-group-title">ç§‘ç±»é€‰æ‹©</div>
                            <div class="subject-options">
                                <div class="subject-option" data-subject="science" data-type="category" onclick="selectSubject(this)">ç†ç§‘</div>
                                <div class="subject-option" data-subject="liberal" data-type="category" onclick="selectSubject(this)">æ–‡ç§‘</div>
                            </div>
                        </div>
                    `;
                }

                content.innerHTML = html;
                selection.classList.remove('changing');

                // æ¸…é™¤éªŒè¯æç¤º
                hideValidationHint();
            }, 200);
        }

        // é€‰æ‹©ç§‘ç›®
        function selectSubject(element) {
            const subject = element.dataset.subject;
            const type = element.dataset.type;

            if (currentExamType === 1) {
                // 3+1+2æ¨¡å¼
                if (type === 'primary') {
                    // é¦–é€‰ç§‘ç›®ï¼Œå•é€‰
                    document.querySelectorAll('[data-type="primary"]').forEach(el => el.classList.remove('selected'));
                    element.classList.add('selected');
                    selectedSubjects = selectedSubjects.filter(s => !['physics', 'history'].includes(s));
                    selectedSubjects.push(subject);
                } else if (type === 'secondary') {
                    // å†é€‰ç§‘ç›®ï¼Œæœ€å¤šé€‰2é—¨
                    const secondarySelected = selectedSubjects.filter(s => ['chemistry', 'biology', 'geography', 'politics'].includes(s));

                    if (element.classList.contains('selected')) {
                        element.classList.remove('selected');
                        selectedSubjects = selectedSubjects.filter(s => s !== subject);
                    } else if (secondarySelected.length < 2) {
                        element.classList.add('selected');
                        selectedSubjects.push(subject);
                    } else {
                        showValidationHint('å†é€‰ç§‘ç›®æœ€å¤šåªèƒ½é€‰æ‹©2é—¨');
                        return;
                    }
                }
            } else if (currentExamType === 0) {
                // 3+3æ¨¡å¼ï¼Œæœ€å¤šé€‰3é—¨
                if (element.classList.contains('selected')) {
                    element.classList.remove('selected');
                    selectedSubjects = selectedSubjects.filter(s => s !== subject);
                } else if (selectedSubjects.length < 3) {
                    element.classList.add('selected');
                    selectedSubjects.push(subject);
                } else {
                    showValidationHint('é€‰è€ƒç§‘ç›®æœ€å¤šåªèƒ½é€‰æ‹©3é—¨');
                    return;
                }
            } else if (currentExamType === 2) {
                // æ–‡ç†åˆ†ç§‘ï¼Œå•é€‰
                document.querySelectorAll('[data-type="category"]').forEach(el => el.classList.remove('selected'));
                element.classList.add('selected');
                selectedSubjects = [subject];
            }

            hideValidationHint();
            console.log('å½“å‰é€‰æ‹©çš„ç§‘ç›®:', selectedSubjects);
        }

        // æ˜¾ç¤ºéªŒè¯æç¤º
        function showValidationHint(message) {
            const hint = document.getElementById('validationHint');
            hint.textContent = message;
            hint.classList.add('show');
        }

        // éšè—éªŒè¯æç¤º
        function hideValidationHint() {
            const hint = document.getElementById('validationHint');
            hint.classList.remove('show');
        }

        // è·å–ç§‘ç±»IDï¼ˆæ ¹æ®é€‰æ‹©çš„ç§‘ç›®åˆ¤æ–­ï¼‰
        function getSubjectCategoryId() {
            // å¦‚æœé€‰æ‹©äº†ç‰©ç†ï¼Œè¿”å›1ï¼ˆç†ç§‘ç±»ï¼‰
            if (selectedSubjects.includes('physics') || selectedSubjects.includes('science')) {
                return 1;
            }
            // å¦åˆ™è¿”å›2ï¼ˆå†å²ç±»/æ–‡ç§‘ç±»ï¼‰
            return 2;
        }

        // éªŒè¯ç§‘ç›®é€‰æ‹©æ˜¯å¦å®Œæ•´
        function validateSubjectSelection() {
            if (!currentExamType || selectedSubjects.length === 0) {
                showValidationHint('è¯·é€‰æ‹©ç§‘ç›®');
                return false;
            }

            if (currentExamType === 1) {
                // 3+1+2æ¨¡å¼ï¼šéœ€è¦é€‰æ‹©1é—¨é¦–é€‰ç§‘ç›®å’Œ2é—¨å†é€‰ç§‘ç›®
                const hasPrimary = selectedSubjects.some(s => ['physics', 'history'].includes(s));
                const secondaryCount = selectedSubjects.filter(s => ['chemistry', 'biology', 'geography', 'politics'].includes(s)).length;

                if (!hasPrimary) {
                    showValidationHint('è¯·é€‰æ‹©é¦–é€‰ç§‘ç›®ï¼ˆç‰©ç†æˆ–å†å²ï¼‰');
                    return false;
                }
                if (secondaryCount !== 2) {
                    showValidationHint('è¯·é€‰æ‹©2é—¨å†é€‰ç§‘ç›®');
                    return false;
                }
            } else if (currentExamType === 0) {
                // 3+3æ¨¡å¼ï¼šéœ€è¦é€‰æ‹©3é—¨ç§‘ç›®
                if (selectedSubjects.length !== 3) {
                    showValidationHint('è¯·é€‰æ‹©3é—¨é€‰è€ƒç§‘ç›®');
                    return false;
                }
            } else if (currentExamType === 2) {
                // æ–‡ç†åˆ†ç§‘ï¼šéœ€è¦é€‰æ‹©1é—¨
                if (selectedSubjects.length !== 1) {
                    showValidationHint('è¯·é€‰æ‹©æ–‡ç§‘æˆ–ç†ç§‘');
                    return false;
                }
            }

            return true;
        }

        // æœç´¢å­¦æ ¡å®˜ç½‘
        function searchSchoolWebsite(schoolName) {
            // æ„å»ºæœç´¢æŸ¥è¯¢ï¼Œæ·»åŠ "å®˜ç½‘"å…³é”®è¯ä»¥æé«˜æœç´¢ç²¾åº¦
            const searchQuery = encodeURIComponent(`${schoolName}`);
            // ä½¿ç”¨ç™¾åº¦æœç´¢ï¼ˆåœ¨ä¸­å›½æ›´å¸¸ç”¨ï¼‰
            const searchUrl = `https://www.baidu.com/s?wd=${searchQuery}`;
            // åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€æœç´¢ç»“æœ
            window.open(searchUrl, '_blank');
        }

    </script>
</body>
</html>
